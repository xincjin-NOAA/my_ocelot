pipeline:
  subsample:
    seed: 12345
    satellite:         
      _default: 20     # default for any unspecified instrument
      atms: 6          # OPTIMIZED: ~70M/6 = ~11.6M obs per 12h window (based on actual data)
      # avhrr: 100     # COMMENTED OUT - no AVHRR data for 2022  
      amsua: 2         # OPTIMIZED: Balance with ATMS - reduce from ~750k to ~375k obs per 12h window   
    conventional:
      _default: 1
      surface_obs: 1
      # snow_cover: 1        # COMMENTED OUT - no snow_cover_2022 in data_v6
    mode:
      satellite:
        _default: random  # "stride" | "random" | "none"
        atms: random
        amsua: random
        # avhrr: random  # COMMENTED OUT - no AVHRR data for 2022
      conventional:
        _default: random
        # snow_cover: none    # COMMENTED OUT - no snow_cover_2022 in data_v6


instrument_weights:
  atms: 1.0                       # Equal weight - balanced data volumes
  amsua: 1.2                      # Slightly higher - more mature instrument with consistent performance  
  surface_obs: 2.0                # Higher weight - critical for surface analysis and needs more attention
  # avhrr: 1.0                    # COMMENTED OUT - no AVHRR data for 2022
  # snow_cover: 1.0               # COMMENTED OUT - no snow_cover_2022 in data_v6

channel_weights:
  # Optimized ATMS weights based on statistical stability and NWP importance
  atms: [1.0, 1.0, 1.1, 1.3, 1.4, 1.3, 1.2, 1.1, 1.0, 0.9, 0.9, 1.0, 1.1, 1.2, 1.2, 0.8, 0.7, 1.0, 1.1, 1.2, 1.3, 1.2] 
  # Optimized AMSUA weights - boost stable temperature sounding channels, reduce noisy ones
  amsua: [0.9, 0.8, 1.2, 1.4, 1.3, 1.4, 1.5, 1.3, 1.2, 1.2, 1.0, 1.1, 1.2, 1.1, 0.7]
  # Enhanced surface obs weights - emphasize temperature and pressure
  surface_obs: [1.8, 1.5, 1.2, 1.0, 1.1, 1.1]   # [pressure, temp, dewpoint, RH, wind_u, wind_v]
  # avhrr: [1.0, 1.0, 1.0]       # COMMENTED OUT - no AVHRR data for 2022
  # snow_cover: [1.0]            # COMMENTED OUT - no snow_cover_2022 in data_v6

observation_config:
  satellite:
    atms:
      zarr_name: atms_2022        # Updated for 2022-specific zarr file
      sat_ids: [224, 225]
      features: [bt_channel_1, bt_channel_2, bt_channel_3, bt_channel_4, bt_channel_5,
                 bt_channel_6, bt_channel_7, bt_channel_8, bt_channel_9, bt_channel_10,
                 bt_channel_11, bt_channel_12, bt_channel_13, bt_channel_14, bt_channel_15,
                 bt_channel_16, bt_channel_17, bt_channel_18, bt_channel_19, bt_channel_20,
                 bt_channel_21, bt_channel_22]
      metadata: [sensorZenithAngle, solarZenithAngle, solarAzimuthAngle]
      input_dim: 32
      target_dim: 22
      encoder_hidden_layers: 2
      decoder_hidden_layers: 2

    amsua:
      zarr_name: amsua_2022       # Updated for 2022-specific zarr file
      sat_ids: [3, 5, 206, 209, 223]
      features: [bt_channel_1, bt_channel_2, bt_channel_3, bt_channel_4, bt_channel_5,
                bt_channel_6, bt_channel_7, bt_channel_8, bt_channel_9, bt_channel_10,
                bt_channel_11, bt_channel_12, bt_channel_13, bt_channel_14, bt_channel_15]
      metadata: [sensorZenithAngle, solarZenithAngle, solarAzimuthAngle]
      input_dim: 25
      target_dim: 15
      encoder_hidden_layers: 2
      decoder_hidden_layers: 2

    # COMMENTED OUT - no AVHRR data for 2022
    # avhrr:
    #   sat_ids: [3, 5, 209, 223]
    #   features: [brightnessTemperature_ch_50, brightnessTemperature_ch_51, brightnessTemperature_ch_52]
    #   metadata: [satelliteZenithAngle, solarZenithAngle]
    #   input_dim: 12
    #   target_dim: 3
    #   encoder_hidden_layers: 2
    #   decoder_hidden_layers: 2

  conventional:
    surface_obs:
      source: zarr
      zarr_name: raw_surface_obs_2022    # Updated for 2022-specific zarr file
      features: [airPressure, airTemperature, dewPointTemperature, relativeHumidity, wind_u, wind_v]
      metadata: [height]
      input_dim: 14                      # 7 (geo/time enc) + 1 meta + 6 feats
      target_dim: 6
      encoder_hidden_layers: 2
      decoder_hidden_layers: 2
      qc_filters:
        airPressure:
          range: [300, 1200]
          qm_flag_col: airPressureQuality_event_1
          keep: [1,2,4,9]
        airTemperature:
          range: [-80, 60]
          qm_flag_col: airTemperatureQuality_event_1
          keep: [1,2,4,9]
        dewPointTemperature:
          range: [-100, 40]
          qm_flag_col: dewPointTemperatureQuality_event_1
          keep: [1,2,4,9]
        relativeHumidity:
          range: [0, 100]
        windSpeed:
          range: [0, 75]
        windDirection:
          range: [0, 360]   # degrees

      qc_relations:                   # cross-variable checks
        dewpoint_le_temp: true        # Td ≤ T (+0.5 °C margin)
        max_temp_dewpoint_spread: 60  # °C; invalid if T - Td > 60
        rh_from_td_consistency_pct: 25  # %pts; invalidate RH if |RH - RH*| > 25
        pressure_vs_height:
          enable: true
          tolerance_hpa: 100          # |p - p_exp(height)| ≤ 100 hPa
          scale_height_m: 8000

    # COMMENTED OUT - no snow_cover_2022 in data_v6
    # snow_cover:
    #   source: zarr
    #   zarr_name: snow_cover
    #   features: [snowDepth]
    #   metadata: [height, airTemperature]
    #   qc_filters:
    #     snowDepth:
    #       range: [0, 6.5]
    #   input_dim: 10          # dims: 7 (geo/time) + 2 meta + 1 feat
    #   target_dim: 1
    #   encoder_hidden_layers: 2
    #   decoder_hidden_layers: 2

feature_stats:  # Statistics for the features used in the model
  surface_obs:
    airPressure: [978.24, 57.32]
    airTemperature: [14.12, 12.15]
    dewPointTemperature: [8.07, 11.52]
    relativeHumidity: [74.38, 19.18]
    wind_u: [0.16, 3.64]
    wind_v: [0.10, 3.37]
  # snow_cover:              # COMMENTED OUT - no snow_cover_2022 in data_v6
  #   snowDepth: [0.38, 0.68]
  atms:
    bt_channel_1: [211.00, 40.60]
    bt_channel_2: [201.65, 42.08]
    bt_channel_3: [239.09, 22.24]
    bt_channel_4: [248.58, 17.55]
    bt_channel_5: [252.58, 14.32]
    bt_channel_6: [245.75, 11.47]
    bt_channel_7: [231.98, 8.21]
    bt_channel_8: [222.52, 6.76]
    bt_channel_9: [216.10, 7.30]
    bt_channel_10: [211.99, 9.49]
    bt_channel_11: [215.01, 9.37]
    bt_channel_12: [221.00, 10.17]
    bt_channel_13: [229.26, 11.30]
    bt_channel_14: [240.06, 11.97]
    bt_channel_15: [250.28, 11.52]
    bt_channel_16: [237.76, 28.61]
    bt_channel_17: [258.29, 29.35]
    bt_channel_18: [260.31, 22.15]
    bt_channel_19: [258.26, 18.46]
    bt_channel_20: [255.12, 15.34]
    bt_channel_21: [250.24, 12.39]
    bt_channel_22: [245.38, 10.41]
  amsua:
    bt_channel_1: [209.92, 40.44]
    bt_channel_2: [201.16, 42.14]
    bt_channel_3: [239.63, 20.68]
    bt_channel_4: [252.44, 14.20]
    bt_channel_5: [245.45, 11.31]
    bt_channel_6: [231.10, 7.86]
    bt_channel_7: [222.16, 6.51]
    bt_channel_8: [216.24, 7.12]
    bt_channel_9: [211.48, 9.39]
    bt_channel_10: [214.51, 9.34]
    bt_channel_11: [220.23, 10.18]
    bt_channel_12: [228.57, 11.32]
    bt_channel_13: [239.08, 11.94]
    bt_channel_14: [249.39, 11.47]
    bt_channel_15: [237.78, 28.23]
  avhrr:
    brightnessTemperature_ch_50: [284.58, 17.52]
    brightnessTemperature_ch_51: [283.07, 15.83]
    brightnessTemperature_ch_52: [281.21, 15.2]