bufr:
  group_by_variable: windDirection
  variables:
    timestamp:
      datetime:
        year: "*/YEAR"
        month: "*/MNTH"
        day: "*/DAYS"
        hour: "*/HOUR"
        minute: "*/MINU"

    latitude:
      query: "*/CLATH"

    longitude:
      query: "*/CLONH"

    reportId:
      query: "*/RPID"

    # driftDisplacementTime:
    #   query: "*/UARLVB/LTDS"

    # driftLatitude:
    #   query: "*/UARLVB/LATDH"

    # driftLongitude:
    #   query: "*/UARLVB/LONDH"

    height_bufr:
      query: "*/HEIT"
      type: float

    geopotentialHeight_gp07:
      query: "*/UARLVB/UAGP07/GP07"
      type: float

    geopotentialHeight_gp10:
      query: "*/UARLVB/UAGP10/GP10"
      type: float

    geopotentialHeightQuality:
      query: "*/UARLVB/QMGP"

    airPressure:
      query: "*/UARLVB/PRLC"  # Air pressure at station level
      type: float
      transforms:
        - scale: 0.01  # Convert from Pa to hPa

    airTemperature:
      query: "*/UARLVB/UATMP/TMDB"
      transforms:
        - offset: -273.15 # Convert Kelvin to deg C

    dewPointTemperature:
      query: "*/UARLVB/UATMP/TMDP"
      transforms:
        - offset: -273.15 # Convert Kelvin to deg C

          #relativeHumidity: # only applies to NC004005
          #   query: "*/REHU"

    windDirection:
      query: "*/UARLVB/UAWND/WDIR"
      type: float
      transforms:
        - scale: 0.0174533  # Convert degrees to radians

    windSpeed:
      query: "*/UARLVB/UAWND/WSPD"

encoder:
  variables:
    # MetaData
    - name: "ObsValue/height_bufr"
      source: height_bufr
      longName: "height of Station (SELV)"
      units: "m"

    - name: "ObsValue/geopotentialHeight_gp07"
      source: geopotentialHeight_gp07
      longName: "Geopotential Height Class 7"
      units: "m2/s2"

    - name: "ObsValue/geopotentialHeight_gp10"
      source: geopotentialHeight_gp10
      longName: "Geopotential Height Class 10"
      units: "m2/s2"

    - name: "geopotentialHeightQuality"
      source: geopotentialHeightQuality
      longName: "Geopotential Height Quality Marker"

    - name: "ObsValue/airTemperature"
      source: airTemperature
      longName: "Air Temperature"
      units: "C"
        #range: [-100, 100]

    - name: "ObsValue/dewPointTemperature"
      source: dewPointTemperature
      longName: "Dew Point Temperature"
      units: "C"
        #range: [ -100, 100 ]

        #- name: "ObsValue/relativeHumidity"
        # source: relativeHumidity
        #longName: "Relative Humidity"
        #units: "%"
        #range: [0, 50000]

    - name: "ObsValue/windDirection"
      source: windDirection
      longName: "Wind Direction"
      units: "radians"

    - name: "ObsValue/windSpeed"
      source: windSpeed
      longName: "Wind Speed"
      units: "m/s"

    - name: "ObsValue/airPressure"
      source: airPressure
      longName: "Air Pressure"
      units: "hPa"
