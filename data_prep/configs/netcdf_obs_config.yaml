# Configuration for NetCDF observation data processing

# Base directories
base_dirs:
  # Input base directory containing gdas.YYYYMMDD subdirectories
  input: "/scratch5/purged/Xin.C.Jin/my_ocelot/diag"
  # Output base directory for parquet files
  output: "/scratch3/NCEPDEV/stmp/Xin.C.Jin/data/ocelot/data_v6/nc_global"

# Default channel variables (used by all observation types)
default_channel_vars: &default_channel_vars
  - chaninfoidx
  - frequency
  - polarization
  - wavenumber
  - error_variance
  - mean_lapse_rate
  - use_flag
  - sensor_chan
  - satinfo_chan

# Default observation variables (used by most observation types)
default_obs_vars: &default_obs_vars
  - Channel_Index
  - Observation_Class
  - Latitude
  - Longitude
  - Elevation
  - Obs_Time
  - Scan_Position
  - Sat_Zenith_Angle
  - Sat_Azimuth_Angle
  - Sol_Zenith_Angle
  - Sol_Azimuth_Angle
  - Sun_Glint_Angle
  - Scan_Angle
  - Water_Fraction  # Only used by IASI, but harmless for others (won't be in output if not mapped)
  - Observation

# Default output variables (used by most observation types)
# Format: output_column_name: NetCDF_Variable_Name
default_output_variables: &default_output_vars
  latitude: Latitude
  longitude: Longitude
  obs_time: Obs_Time
  scan_position: Scan_Position
  sat_zenith_angle: Sat_Zenith_Angle
  sat_azimuth_angle: Sat_Azimuth_Angle
  sol_zenith_angle: Sol_Zenith_Angle
  sol_azimuth_angle: Sol_Azimuth_Angle
  sun_glint_angle: Sun_Glint_Angle
  scan_angle: Scan_Angle

# Observation types and their associated satellite IDs
observations:
  atms:
    sat_ids:
      - n20
      - n21
      - npp
    description: "Advanced Technology Microwave Sounder"
    
    # Channel information variables (dimension: nchans)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars
    
    # Variables to include in output Parquet file
    output_variables: *default_output_vars
  
  amsua:
    sat_ids:
      - n15
      - n18
      - n19
      - metop-b
      - metop-c
    description: "Advanced Microwave Sounding Unit-A"
    
    # Channel information variables (dimension: nchans = 15)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars
    
    # Variables to include in output Parquet file
    output_variables: *default_output_vars
  
  avhrr:
    sat_ids:
      - n18
      - n19
      - metop-b
      - metop-c
    description: "Advanced Very High Resolution Radiometer"
    
    # Channel information variables (dimension: nchans = 3)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars
    
    # Variables to include in output Parquet file
    output_variables: *default_output_vars

  surface_obs_uv:
    description: "Surface observations (conventional)"
    row_filter:
      var: Observation_Type
      values: [280, 281, 282, 284, 287]
    obs_vars: 
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - u_Observation
      - u_Obs_Minus_Forecast_adjusted
      - u_Obs_Minus_Forecast_unadjusted
      - v_Observation
      - v_Obs_Minus_Forecast_adjusted
      - v_Obs_Minus_Forecast_unadjusted
    output_variables:
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - u_Observation
      - u_Obs_Minus_Forecast_adjusted
      - u_Obs_Minus_Forecast_unadjusted
      - v_Observation
      - v_Obs_Minus_Forecast_adjusted
      - v_Obs_Minus_Forecast_unadjusted
    input_src: conv_uv

  surface_obs_t:
    description: "Surface observations (conventional)"
    row_filter:
      var: Observation_Type
      values: [180, 181, 182, 183, 187]
    obs_vars: 
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - Observation
    output_variables:
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - Observation
    input_src: conv_t
  sst:
    description: "Surface observations (conventional)"
    obs_vars: 
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - Observation
    output_variables:
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Station_Elevation
      - Pressure
      - Height
      - Time
      - Observation
    input_src: conv_sst

  gps:
    description: "Surface observations (conventional)"
    obs_vars: 
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Model_Elevation
      - Pressure
      - Height
      - Time
      - Incremental_Bending_Angle
      - Observation
    output_variables:
      - Station_ID
      - Observation_Type
      - Observation_Subtype
      - Latitude
      - Longitude
      - Model_Elevation
      - Pressure
      - Height
      - Time
      - Incremental_Bending_Angle
      - Observation
    input_src: conv_gps
  ssmis:
    sat_ids:
      - f17
    description: "Special Sensor Microwave Imager/Sounder"
    
    # Channel information variables (dimension: nchans = 24)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars
    
    # Variables to include in output Parquet file
    output_variables: *default_output_vars
  
  iasi:
    sat_ids:
      - metop-b
      - metop-c
    description: "Infrared Atmospheric Sounding Interferometer"
    
    # Channel information variables (dimension: nchans = 616)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars  # Includes Water_Fraction
    
    # Variables to include in output Parquet file
    # IASI has additional water_fraction variable
    output_variables:
      <<: *default_output_vars
      water_fraction: Water_Fraction
  
  cris-fsr:
    sat_ids:
      - n20
      - n21
    description: "Cross-track Infrared Sounder - Full Spectral Resolution"
    
    # Channel information variables (dimension: nchans = 431)
    channel_vars: *default_channel_vars
    
    # Observation data variables (dimension: nobs)
    obs_vars: *default_obs_vars
    
    # Variables to include in output Parquet file
    output_variables: *default_output_vars

# Default cycles to process
default_cycles:
  - "00"
  - "06"
  - "12"
  - "18"

# File naming pattern
# {obs_type} will be replaced with observation type (e.g., atms)
# {sat_id} will be replaced with satellite ID (e.g., n21)
# {date_cycle} will be replaced with YYYYMMDDHH
file_pattern: "diag_{obs_type}_{sat_id}_ges.{date_cycle}.nc4"

# Directory structure pattern
# {date} will be replaced with YYYYMMDD
# {cycle} will be replaced with HH (00, 06, 12, 18)
dir_pattern: "gdas.{date}/{cycle}/atmos"
